---
title: "Modelo pib, cetes"
output: pdf_document
date: "2023-03-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Voy a ajustar un modelo para pronosticar el logaritmo de la circulación de efectivo utilizando el logaritmo del PIB y el logaritmo de los cetes 28 días. La serie del efectivo con la metodología actual empieza en el 2001, entonces en total tengo historia desde enero 2001 hasta diciembre 2022. Una ventaja y desventaja a la vez del DLM es que necesita una distribución inicial $(\theta_0 \mid D_0 )$ para iniciar. Esto es bueno cuando se conoce el problema y se puede proponer la distribución inicial. Sin embargo, este no es mi caso, entonces mi idea es dividir los datos en dos: de 2001 a 2010 para estudiar las relaciones entre las variables y poder inferir una distribución inicial y poder correr el filtro de Kalman en el periodo 2011-2022. Otro problema importante es que no conozco los valores de $G_t$, $W_t$ y $V_t$. Para facilitar su estimación, asumí que son constantes. Utilicé MARSS para ajustar estos valores. Lo que hace MARSS es que utiliza todos los datos que le das para estimar los valores desconocidos. Entonces, cuando correr el filtro de Kalman teóricamente no obtienes $(Y_t \mid D_{t-1})$, porque para la estimación de los valores usaste todos los datos, no solo hasta $D_{t-1}$. Por esto no puedo usar MARSS para estimar los valores para toda la serie, mejor uso MARSS para estimar todo lo desconocido con datos del 2001 a 2010, y para el periodo de 2011 a 2022 utilizo esos valores como si fueran conocidos. En el caso de $(\theta_0 \mid D_0 )$ tulizaría la última distribución obtenida en el periodo de 2001 a 2010.

Como mi meta final es realizar pronósticos, me gustaría únicamente utilizar variables que Banxico pronostique, para que yo no tenga que hacer pronósticos de las variables dependientes y no meterme en otro problema, sería mejor usar directamente los pronósticos de Banxico.
Estuve investigando y variables útiles de las que puedo encontrar pronósticos en Banxico son el PIB, Cetes 28 días, el tipo de cambio y la inflación. La teoría dice que el coeficiente del PIB debe ser positivo por ser una variable de actividad, los cetesm el tipo de cambio y la inflación negativas por ser de costo de oportunidad. El tipo de cambio siempre me daba positivo, entonces lo quité. Además, la correlación entre tipo de cambio y efectivo es muy positiva, lo que no tiene sentido según la teoría. La inflación, aunque sí está correlacionada negativamente con el efectivo, me daba un coeficiente positivo en el modelo, entonces por ahora la quité, podría intentar meterla más adelante. Los datos son trimestrales.

Te mando los resultados del periodo 2011 a 2010. Todavía no veo si los valores que estimé aquí funcionan bien de 2011 a 2022, cuando lo vea te lo mando.


# Datos.
Leo los datos que obtuve y limpié de Banxico
```{r}
datos_pib <- read_rds('cache/variables/pib.rds') %>% 
  filter(fecha <= 2010.75) %>% 
  mutate(pib = log(pib))

datos_cetes_28d <- read_rds('cache/variables/cetes_28d_trim.rds') %>% 
  filter(fecha <= 2010.75) %>% 
  mutate(cetes_28d = log(cetes_28d))

datos_efectivo <- read_rds('cache/variables/efectivo_trim.rds') %>% 
  filter(fecha <= 2010.75) %>% 
  mutate(efectivo = log(efectivo))
```

Las correlaciones concuerdan con la teoría:

```{r}
cor(datos_efectivo$efectivo, datos_pib$pib)
cor(datos_efectivo$efectivo, datos_cetes_28d$cetes_28d)
```

Gráfica de efectivo trimestral
```{r}
ggplot(datos_efectivo, aes(fecha, efectivo)) +
  geom_line() +
  geom_vline(xintercept = 2020.00, color = 'red')+
  theme_classic() +
  xlab("Año") +
  ylab("Circulación")
```

Gráfica de 

